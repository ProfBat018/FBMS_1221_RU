# Введение в ASP.NET

Есть очень много разновидностей ASP.NET проектов
* ASP.NET Core Web App
* ASP.NET Core Web API
* ASP.NET Core MVC
* ASP.NET Core Blazor Server App
* ASP.NET Core Blazor Client App


## Razor Pages

Это технология, которая позволяет совместить C# и HTML

Такии образом вы упрощаете свою работу. 

Все файлы Razor Pages имеют расширение `.cshtml`

### Типы Razor Pages
* Razor Layout Page
* Razor View 
* Razor Page
* Razor View Imports
* Razor Partial View


# Middleware 

Это подпрограммы, которые по одному обрабатывают ваши запросы
по паттерну ChainOfResponsibility

Когда я сказал запрос, я имел ввиду `HttpContext`

# Microsoft.Extensions.DI

Это IOC контейнер, который позволяет мне хранить ссылки на объекты

Есть несколько методов для этого
* AddSingleton
* AddScoped
* AddTransient
* AddDbContext  // Работает после установки пакета Microsoft.EntityFrameworkCore


### AddSingleton
Одна ссылка на объект на все время работы приложения, то есть вашего сайта

Пример: У вас в приложении есть сервис `EmailSender` по сути он одинаковый для 
каждого юзера, просто принимает разные параметры. В таком случае вы можете
использовать `AddSingleton` для того, чтобы не создавать новый объект `EmailSender`

### AddTransient
Один объект на один запрос, то есть на один `HttpContext`. 
Каждый раз, когда приходит новый запрос, создается новый объект

Пример: У вас есть сервис, который используется реже чем остальные и для 
каждого пользовтеля он должен быть отдельный. В таком случае нет смылса создавать
этот объект для каждого пользователя. Надо создать его под определенным запрос.

### AddScoped
Объект создается каждый раз, когда пользователь заходит на страницу.

Например, чтобы зайти на страницу с товарами, он по любому должен взять данные из БД.
И в таком случае нет смысла создавать его под каждый запрос, но и создавать один раз
на все время работы приложения тоже не стоит. Поэтому создается один объект на один вход.

-----------------------------------------------------------------

# Урок 2 - Введение в Razor Pages

Пожалуй начнем с `Layout.cshtml` 

Это файл, который можно сравнить с `MainView` 
который был в `WPF`. Еслм вы помните, то мы с вами 
сделали `ContentControl` и в него мы подгружали 
наши `View`. Так вот, `Layout.cshtml` это как раз тоже 
самое. 

В нем хранится весь ваш `HTML` код, `head`, `main`, `header`, `footer`

Все остальные файлы будут подгружаться в `Layout.cshtml`

`@RenderBody` - это тег, который говорит, что в этом месте будет подгружаться
ваш `View`

Это и есть тот самый `ContentControl` из `WPF`

## C# в Razor Pages

Весь C# код пишется после `@`

Сразу же раз и навсегда обсудим три момента: 
1. ViewData
2. ViewBag
3. TempData


### ViewData

ViewData - Dictionary, который хранит в себе пары ключ-значение

По сути это словарь, который нужен нам для передачи данных между разными 
страницами в нашем приложении.

### ViewBag

Это тоже самое, что и `ViewData`, только вместо словаря у нас просто object

Они полностью идентичны, но `ViewBag` удобнее использовать, так как 
вы можете обращаться к нему как к обычному объекту

### TempData

Это тоже самое, что и `ViewData`, только данные хранятся в сессии. 
Это тоже `Dictionary`, но он хранит данные в сессии. Что значит в сессии ?
Это значит, что данные будут храниться до тех пор, пока пользователь не закроет
вкладку с вашим сайтом. 

К примеру вы добавили товар в корзину, и вам приходит `modal` в котором говорится 
что товар добавлен в корзину или нет. Нам не нужно хранить данные каждого пользователя
навсегда у себя на сервере.

Просто представьте что у нас 1000 пользователей и мы храним данные о добавлении товара каждого пользователя 
у себя на сервере. Ну или данные о том какую тему он использует. Это бессмысленно. Если 
я буду сидеть и весь день нажимать на кнопку добавить товар в корзину, то у вас
сервер просто упадет.

По сути `TempData` это `ViewData`, который хранится в сессии.

Вот реальный пример использования `TempData`:

Представьте, что у вас есть код, который генеруется каждый раз, когда пользователь заходит на сайт.
По идее нет смысла хранить его в `ViewData`, так как он будет генерироваться каждый раз. 
При этом если мы хотим, чтобы пользователь в течении сессии видел этот код, а потом нет, то
нам нужно использовать `TempData`.


```csharp
@page
@model IndexModel

@{
    ViewData["Title"] = "Home page";
    ViewBag.Title = "Home page"
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
</div>

```

Вот так выглядит `Index.cshtml`

`@page` - это директива, которая говорит, что это `Razor Page`

`@model IndexModel` - это директива, которая говорит, что это `Model` для `Razor Page`

`@{ }` - это блок кода, который будет выполняться на сервере

`@ViewData["Title"] = "Home page";` - это пример использования `ViewData`
`@ViewBag.Title = "Home page"` - это пример использования `ViewBag`

`<h1 class="display-4">Welcome @Model.Name</h1>` - по сути это обычный `Binding` в `WPF`

### Иерархия файлов в Razor Pages

Все файлы в `Razor Pages` имеют расширение `.cshtml`

Все файлы в `Razor Pages` имеют свою иерархию

`Pages` - это папка, в которой хранятся все `Razor Pages`

`Pages/Shared` - это папка, в которой хранятся все `Layout` файлы

`Pages/Shared/_Layout.cshtml` - это файл, который хранит в себе `Layout` для всех страниц

`Pages/Shared/_ViewStart.cshtml` - это файл, который говорит, что `Layout` будет использоваться для всех страниц

`Pages/Shared/_ViewImports.cshtml` - это файл, который говорит, какие `using` будут использоваться для всех страниц

`Pages/Shared/_ValidationScriptsPartial.cshtml` - это файл, который хранит в себе `JavaScript` для валидации форм

Вот тут надо поподробнее остановиться на `ValidationScriptsPartial.cshtml`

Валидаця формы - это когда вы вводите данные в форму и нажимаете на кнопку отправить,
а вам выдает ошибку, что вы не ввели данные в поле.

Вот этот `JavaScript` код хранится в `ValidationScriptsPartial.cshtml`


### Session  в Razor Pages

Все данные, которые хранятся в `Session` хранятся в `HttpContext.Session`

`HttpContext.Session` - это `Dictionary`, который хранит в себе пары ключ-значение

Чтобы использовать `Session` в `Razor Pages` нам нужно добавить `services.AddSession();` в `Startup.cs`

```csharp
	services.AddSession();
	services.AddRazorPages();
```

Конечно же нельзя забывать про `services.UseSession();` в `Configure`

```csharp
	app.UseSession();
```
